# 运行

2022.12.7，中证500ETF的金字塔回测：

`python -m dingtou.pyramid.pyramid -c 510500 -s 20180101 -e 20211201 -b sh000905`


# 起因
看了解读《基金定投》基金定投的方法！如何买基金，基金定投亏钱怎么办? ，对他说的定投可以赚钱的说法甚是喜欢。

就觉得 定投+网格交易法，一定是一个很靠谱的投资方法，是一个投资发财的好方法，于是就迫不及待地写了一个回测来证明一下。

然而，事实是...

# 经过

用大盘/指数(上证、沪深300、中证500...)做择时定投，在年均线下，下跌，且比前一天低，定投，越跌投金额越多

用基金本身做定投 ，用基金自己的月均线，跌破就投，越跌越投

做直接的定投

# 设计

做了一个小的回测框架，再backtest中，

核心类是BackTester，他会读数据中的所有日期，合并，排序后，拿这个当做一个迭代日期，然后开始回测迭代。

当然只有在start_date和end_date中的日期，才会回测，否则就忽略。

每天，都会先去调用一下策略Strategy类的next，这个类里会触发各种买卖信号，并产生交易单。

交易单，都是第二天的价格来成交的，基金也是，这个是参考的之前的股票的规则。

为了统一，把所有的日期都改名成date，价格都改名称close，且，都把日期当做了dataframe的索引。

不愿意用backtrader，主要是因为它太重，我自己写个灵巧的，自己够用就好。

运行完会得到一个console结果：

```commandline
交易统计：
	基金代码：003095
	基准指数：sh000905
	投资起始：'20180102~20211231: 3年11月'
	定投起始：'20180205'~'20211227'
	组合收益：81.4% 	<---
	组合年化：16.4% 	<---
	基准收益：14.7%
	基金收益：168.8%
	买入次数：60
	佣金总额：6204.66
	期末现金：80151.11
	期末持仓：826812.80
	期末总值：906963.91
```
和一个debug/xxxx.svg的结果图，xxxx就是基金代码。

数据源用的是[AKShare](https://www.akshare.xyz/data/index/index.html)。

# 结果

- 定投，只对那种下跌的基金有用
- 如果基金是上涨是跑不过基金的
- 如果基金横盘，会略差于基金

真的是纠结，基金大涨，你拿不到红利，但是基金下跌，你是抗跌的，我感觉，定投就是降低了风险而已，应该可以提高夏普比率




# 参考
[【知识精讲】网格交易详解与回测 | 优缺点及应对方法 | 胜率真能达到100%？](https://www.bilibili.com/video/BV1Yf4y177cA/?spm_id_from=333.880.my_history.page.click&vd_source=9743f283e4385666cbcd0d6d08628d90)

[据说稳赚的《网格交易法》，怎么用？是真的吗？](https://www.youtube.com/watch?v=Bn6mJjyxTwU&t=740s) 

[解读《基金定投》基金定投的方法！如何买基金，基金定投亏钱怎么办？_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1TA411x77e/?spm_id_from=333.880.my_history.page.click) 

[网格交易法——数学模型+传统智慧战胜华尔街-学习视频教程-腾讯课堂](https://ke.qq.com/course/335450) 

[掘进量化的各种策略](https://www.myquant.cn/docs/python_strategyies/104)

[网格交易法：数学+传统智慧战胜华尔街](https://cread.jd.com/read/startRead.action?bookId=30150108&readType=1)

代码：

[网格交易法以及在数字货币中基于Python的量化实现](https://juejin.cn/post/6844903998793728007)